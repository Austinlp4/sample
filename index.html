<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
</head>
<body>
  <div id="root"></div>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/react/15.4.2/react.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/react/15.4.2/react-dom.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/6.21.1/babel.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/0.19.0/axios.min.js"></script>
  <script src="SKUNinja-sample-logs.json"></script>
  <script type="text/babel">
  class EventLogViewer extends React.Component {
      constructor(props){
        super(props);
        this.state={
          logs: null,
          loading: true, 
          showModal: false,
          index: '',
          body: ''
        }
      }
      componentDidMount(){
       this.loadData()
      }

      loadData(){
        fetch('./SKUNinja-sample-logs.json')
          .then(res => res.json())
          .then(data => {
            let logs = []
            Object.keys(data).forEach(key => {
              logs.push(data[key])
            })
            this.setState({
              logs,
              loading: false
            })
          })
      }

      renderData(){
        return this.state.logs.map((log, index) => {
          const { id, created, user_id, ip, type, subject, body } = log
          let color = '';
          if(type === '3'){
            color = 'bg-danger'
          } else if(type === '2') {
            color = 'bg-warning'
          } else {
            color = 'bg-success'
          }
          return (
            <tr className={`${color} container-fluid`} data-toggle='modal' data-target={`#${index}`} key={index} onClick={(index, body) => this.showModal(index, body)}>
              <td>{created}</td>
              <td>{subject}</td>  
            </tr>
          )
        })
      } 

    showModal = (index, body) => {
        this.setState({
          showModal: !this.state.showModal,
          index: index,
          body: body
        })
      }

      // modal = (index, body) => {
      //   return (
      //     <div id={`${index}`} className="modal fade" role="dialog">
      //         <div className="modal-dialog">
      //           <div className="modal-content">
      //             <div className="modal-header">
      //               <button type="button" className="close" data-dismiss="modal">&times;</button>
      //               <h4 className="modal-title">Subject</h4>
      //             </div>
      //             <div className="modal-body">
      //               <p>{body}</p>
      //             </div>
      //             <div className="modal-footer">
      //               <button type="button" className="btn btn-default" data-dismiss="modal">Close</button>
      //             </div>
      //           </div>

      //         </div>
      //     </div>
      //   )
      // }
      

      render() {
        if(this.state.loading){
          return <div></div>
        }
        if(this.state.showModal){
          return (
            <div id={`${this.state.index}`} className="modal fade" role="dialog">
              <div className="modal-dialog">
                <div className="modal-content">
                  <div className="modal-header">
                    <button type="button" className="close" data-dismiss="modal">&times;</button>
                    <h4 className="modal-title">Subject</h4>
                  </div>
                  <div className="modal-body">
                    <p>{this.statebody}</p>
                  </div>
                  <div className="modal-footer">
                    <button type="button" className="btn btn-default" data-dismiss="modal">Close</button>
                  </div>
                </div>

              </div>
          </div>
          )
        }
        return (
            <div>
              <h1>Event Log</h1>
              <table>
                <tbody>
                  {
                    this.renderData()
                  }
                </tbody>
              </table>
            </div>
          );
      }
    }
  
  ReactDOM.render(
      <EventLogViewer />,
      document.getElementById('root')
  );
  </script>
  <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>
</body>
</html>